<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outlook AI 2.0 - èåˆç‰ˆï¼ˆå¯„ä»¶äººè¦–è¦ºåŒ– + éƒµä»¶åˆ—è¡¨ï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        /* é ‚éƒ¨å·¥å…·åˆ— */
        .toolbar {
            background: white;
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .toolbar h1 {
            font-size: 28px;
            color: #2d3748;
            flex: 1;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        /* ä¸»è¦å…§å®¹å€ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }

        /* å·¦å´ï¼šå¯„ä»¶äººç®¡ç†å€ */
        .senders-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-header h2 {
            font-size: 24px;
            color: #2d3748;
        }

        /* ä¸‰ç‹€æ…‹å€åŸŸ */
        .status-zone {
            padding: 20px;
            border-radius: 12px;
            border: 2px dashed #e2e8f0;
            min-height: 150px;
            margin-bottom: 24px;
            transition: all 0.3s;
        }

        .status-zone.drag-over {
            border-color: #667eea;
            background: #f7fafc;
            transform: scale(1.02);
        }

        .status-zone.pending {
            background: #fff5f5;
            border-color: #feb2b2;
        }

        .status-zone.processing {
            background: #fffaf0;
            border-color: #fbd38d;
        }

        .status-zone.completed {
            background: #f0fff4;
            border-color: #9ae6b4;
        }

        .zone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .zone-header h3 {
            font-size: 18px;
            color: #2d3748;
        }

        .zone-count {
            background: rgba(0,0,0,0.1);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
        }

        /* å¯„ä»¶äººå¡ç‰‡ç¶²æ ¼ */
        .senders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }

        .sender-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            cursor: move;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }

        .sender-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .sender-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .sender-card.selected {
            border: 3px solid #667eea;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            position: relative;
        }

        .unread-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #fc8181;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .sender-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .sender-company {
            font-size: 11px;
            color: #718096;
            margin-bottom: 8px;
        }

        .tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tag {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 8px;
            font-weight: 600;
        }

        .tag-urgent { background: #fed7d7; color: #c53030; }
        .tag-high { background: #feebc8; color: #c05621; }
        .tag-medium { background: #c6f6d5; color: #2f855a; }
        .tag-value { background: #bee3f8; color: #2c5282; }

        /* éƒµä»¶åˆ—è¡¨ï¼ˆé»æ“Šå¯„ä»¶äººå¾Œå±•é–‹ï¼‰ */
        .emails-list-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #e2e8f0;
        }

        .emails-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .emails-list-header h3 {
            font-size: 18px;
            color: #2d3748;
        }

        .close-list-btn {
            background: #e2e8f0;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            color: #4a5568;
        }

        .close-list-btn:hover {
            background: #cbd5e0;
        }

        .email-item {
            background: #f7fafc;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .email-item:hover {
            background: #edf2f7;
            border-left-color: #667eea;
            transform: translateX(4px);
        }

        .email-item.selected {
            background: #e6fffa;
            border-left-color: #38b2ac;
        }

        .email-item.unread {
            background: #ebf8ff;
            font-weight: 600;
        }

        .email-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .email-subject {
            font-size: 14px;
            color: #2d3748;
            font-weight: 600;
        }

        .email-time {
            font-size: 12px;
            color: #718096;
        }

        .email-preview {
            font-size: 12px;
            color: #718096;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* å³å´ï¼šAI åˆ†æé¢æ¿ */
        .ai-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .ai-panel h2 {
            font-size: 24px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .ai-section {
            background: #f7fafc;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .ai-section h3 {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 12px;
        }

        .note-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            line-height: 1.6;
        }

        .note-item strong {
            color: #667eea;
        }

        .todo-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .todo-item:hover {
            background: #edf2f7;
        }

        .todo-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .todo-item.done {
            opacity: 0.5;
            text-decoration: line-through;
        }

        /* éƒµä»¶å…§å®¹é¡¯ç¤º */
        .email-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 16px;
            line-height: 1.8;
            font-size: 14px;
            color: #2d3748;
        }

        .email-content-header {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 16px;
            margin-bottom: 16px;
        }

        .email-content-subject {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
        }

        .email-content-meta {
            font-size: 13px;
            color: #718096;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .action-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            background: white;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #f7fafc;
            border-color: #667eea;
        }

        .action-btn.primary {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* ç©ºç‹€æ…‹ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* æ’°å¯«éƒµä»¶å½ˆçª— */
        .compose-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .compose-modal.active {
            display: flex;
        }

        .compose-dialog {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .compose-header {
            padding: 24px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .compose-header h2 {
            font-size: 20px;
            color: #2d3748;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            color: #718096;
            cursor: pointer;
        }

        .compose-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 200px;
        }

        .compose-footer {
            padding: 20px 30px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¥å…·åˆ— -->
        <div class="toolbar">
            <h1>ğŸ“§ Outlook AI 2.0 - èåˆç‰ˆ</h1>
            <button class="btn btn-primary" onclick="composeEmail()">âœ‰ï¸ æ’°å¯«éƒµä»¶</button>
            <button class="btn btn-secondary" onclick="syncEmails()">ğŸ”„ åŒæ­¥éƒµä»¶</button>
        </div>

        <!-- ä¸»è¦å…§å®¹ -->
        <div class="main-content">
            <!-- å·¦å´ï¼šå¯„ä»¶äººç®¡ç† + éƒµä»¶åˆ—è¡¨ -->
            <div class="senders-section">
                <div class="section-header">
                    <h2>ğŸ‘¥ å¯„ä»¶äººç®¡ç†ï¼ˆæ‹–æ‹½ç®¡ç†ç‹€æ…‹ï¼‰</h2>
                </div>

                <!-- å¾…è™•ç† -->
                <div class="status-zone pending" ondrop="drop(event, 'pending')" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                    <div class="zone-header">
                        <h3>ğŸ“¬ å¾…è™•ç†</h3>
                        <span class="zone-count" id="pendingCount">0</span>
                    </div>
                    <div class="senders-grid" id="pendingSenders"></div>
                </div>

                <!-- è™•ç†ä¸­ -->
                <div class="status-zone processing" ondrop="drop(event, 'processing')" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                    <div class="zone-header">
                        <h3>âš¡ è™•ç†ä¸­</h3>
                        <span class="zone-count" id="processingCount">0</span>
                    </div>
                    <div class="senders-grid" id="processingSenders"></div>
                </div>

                <!-- å·²å®Œæˆ -->
                <div class="status-zone completed" ondrop="drop(event, 'completed')" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                    <div class="zone-header">
                        <h3>âœ… å·²å®Œæˆ</h3>
                        <span class="zone-count" id="completedCount">0</span>
                    </div>
                    <div class="senders-grid" id="completedSenders"></div>
                </div>

                <!-- éƒµä»¶åˆ—è¡¨ï¼ˆé»æ“Šå¯„ä»¶äººå¾Œé¡¯ç¤ºï¼‰ -->
                <div class="emails-list-section" id="emailsListSection" style="display: none;">
                    <div class="emails-list-header">
                        <h3 id="emailsListTitle">ğŸ“§ éƒµä»¶åˆ—è¡¨</h3>
                        <button class="close-list-btn" onclick="closeEmailsList()">âœ• é—œé–‰</button>
                    </div>
                    <div id="emailsList"></div>
                </div>
            </div>

            <!-- å³å´ï¼šAI åŠ©ç† -->
            <div class="ai-panel">
                <h2>ğŸ¤– AI æ™ºèƒ½åˆ†æ</h2>
                <div id="aiDetailContent">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¡</div>
                        <div>é»æ“Šå¯„ä»¶äººå¡ç‰‡æˆ–éƒµä»¶æŸ¥çœ‹ AI åˆ†æ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ’°å¯«éƒµä»¶å½ˆçª— -->
    <div class="compose-modal" id="composeModal">
        <div class="compose-dialog">
            <div class="compose-header">
                <h2>âœ‰ï¸ æ’°å¯«æ–°éƒµä»¶</h2>
                <button class="close-btn" onclick="closeCompose()">&times;</button>
            </div>
            <div class="compose-body">
                <div class="form-group">
                    <label>æ”¶ä»¶äºº</label>
                    <input type="email" id="emailTo" placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label>ä¸»æ—¨</label>
                    <input type="text" id="emailSubject" placeholder="éƒµä»¶ä¸»æ—¨">
                </div>
                <div class="form-group">
                    <label>å…§å®¹</label>
                    <textarea id="emailBody" placeholder="è¼¸å…¥éƒµä»¶å…§å®¹..."></textarea>
                </div>
            </div>
            <div class="compose-footer">
                <button class="btn btn-secondary" onclick="closeCompose()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="sendEmail()">ç™¼é€</button>
            </div>
        </div>
    </div>

    <script>
        // ===== è³‡æ–™ç®¡ç† =====
        const sendersData = [
            {
                id: 1,
                name: "ç‹å°æ˜",
                company: "ABC ç§‘æŠ€",
                avatar: "ç‹",
                color: "#667eea",
                priority: "high",
                value: "$75K",
                status: "pending",
                totalEmails: 25,
                unreadEmails: 8,
                notes: { product: "X100 ç³»åˆ—", budget: "$50K-$100K", intent: "95%" },
                todos: [
                    { text: "æº–å‚™ç”¢å“è¦æ ¼æ›¸", date: "11/12", done: false },
                    { text: "æä¾›å ±åƒ¹å–®", date: "11/13", done: false }
                ],
                emails: []
            },
            {
                id: 2,
                name: "æç¾ç²",
                company: "XYZ è²¿æ˜“",
                avatar: "æ",
                color: "#f093fb",
                priority: "urgent",
                value: "$35K",
                status: "processing",
                totalEmails: 18,
                unreadEmails: 12,
                notes: { issue: "ç‰©æµå»¶é²", order: "#XYZ-2024-001", deadline: "ä»Šæ—¥" },
                todos: [
                    { text: "ç¢ºèªç‰©æµç‹€æ…‹", date: "ä»Šå¤©", done: false },
                    { text: "å›è¦†å®¢æˆ¶", date: "ä»Šå¤©", done: false }
                ],
                emails: []
            },
            {
                id: 3,
                name: "é™³é›…å©·",
                company: "GHI é›†åœ˜",
                avatar: "é™³",
                color: "#4facfe",
                priority: "high",
                value: "$10M+",
                status: "pending",
                totalEmails: 30,
                unreadEmails: 15,
                notes: { type: "æˆ°ç•¥åˆä½œ", scale: "$10M+", interest: "é•·æœŸ" },
                todos: [
                    { text: "æº–å‚™åˆä½œææ¡ˆ", date: "11/15", done: false },
                    { text: "å®‰æ’é«˜å±¤æœƒè­°", date: "11/18", done: false }
                ],
                emails: []
            },
            {
                id: 4,
                name: "å¼µå»ºåœ‹",
                company: "DEF ä¼æ¥­",
                avatar: "å¼µ",
                color: "#43e97b",
                priority: "medium",
                value: "$20K",
                status: "completed",
                totalEmails: 12,
                unreadEmails: 0,
                notes: { type: "æŠ€è¡“è«®è©¢", status: "å·²å®Œæˆ" },
                todos: [{ text: "æä¾›æŠ€è¡“æ–‡æª”", date: "11/09", done: true }],
                emails: []
            },
            {
                id: 5,
                name: "åŠ‰ç¶“ç†",
                company: "JKL Trading",
                avatar: "åŠ‰",
                color: "#fa709a",
                priority: "medium",
                value: "$45K",
                status: "processing",
                totalEmails: 20,
                unreadEmails: 9,
                notes: { order: "#2024-1015", issue: "å®¢æˆ¶å‚¬å–®" },
                todos: [
                    { text: "æª¢æŸ¥è¨‚å–®é€²åº¦", date: "11/11", done: false },
                    { text: "å›è¦†å®¢æˆ¶", date: "11/11", done: false }
                ],
                emails: []
            }
        ];

        // ç‚ºæ¯ä½å¯„ä»¶äººç”Ÿæˆ 10-30 å°éƒµä»¶
        const emailSubjects = [
            "é—œæ–¼ç”¢å“å ±åƒ¹çš„è¨è«–",
            "Re: æŠ€è¡“è¦æ ¼ç¢ºèª",
            "ç‰©æµé…é€æ™‚é–“ç¢ºèª",
            "è¨‚å–®é€²åº¦æ›´æ–°",
            "æ–°ç”¢å“åˆä½œæ©Ÿæœƒ",
            "æœƒè­°é‚€è«‹ï¼šå°ˆæ¡ˆè¨è«–",
            "Re: å ±åƒ¹å–®ç¢ºèª",
            "å®¢æˆ¶éœ€æ±‚åˆ†æ",
            "åˆä½œææ¡ˆè¨è«–",
            "ç”¢å“å±•ç¤ºé‚€è«‹"
        ];

        sendersData.forEach(sender => {
            const emailCount = sender.totalEmails;
            for (let i = 0; i < emailCount; i++) {
                const daysAgo = Math.floor(Math.random() * 30);
                const date = new Date();
                date.setDate(date.getDate() - daysAgo);

                sender.emails.push({
                    id: `${sender.id}-${i}`,
                    subject: emailSubjects[i % emailSubjects.length],
                    preview: `é€™æ˜¯ä¾†è‡ª ${sender.name} çš„éƒµä»¶å…§å®¹é è¦½...`,
                    body: `è¦ªæ„›çš„æ”¶ä»¶äººï¼Œ\n\n${emailSubjects[i % emailSubjects.length]}\n\næˆ‘å€‘æƒ³èˆ‡æ‚¨è¨è«–ç›¸é—œäº‹å®œã€‚\n\næ­¤è‡´\n${sender.name}\n${sender.company}`,
                    date: date,
                    unread: i < sender.unreadEmails
                });
            }
        });

        let currentSenders = [...sendersData];
        let selectedSender = null;
        let selectedEmail = null;

        // ===== åˆå§‹åŒ– =====
        function init() {
            renderSenders();
            updateStats();
        }

        // ===== æ¸²æŸ“å¯„ä»¶äºº =====
        function renderSenders() {
            const pendingDiv = document.getElementById('pendingSenders');
            const processingDiv = document.getElementById('processingSenders');
            const completedDiv = document.getElementById('completedSenders');

            pendingDiv.innerHTML = '';
            processingDiv.innerHTML = '';
            completedDiv.innerHTML = '';

            currentSenders.forEach(sender => {
                const card = createSenderCard(sender);

                if (sender.status === 'pending') {
                    pendingDiv.appendChild(card);
                } else if (sender.status === 'processing') {
                    processingDiv.appendChild(card);
                } else if (sender.status === 'completed') {
                    completedDiv.appendChild(card);
                }
            });

            updateCounts();
        }

        function createSenderCard(sender) {
            const card = document.createElement('div');
            card.className = 'sender-card';
            if (selectedSender && selectedSender.id === sender.id) {
                card.classList.add('selected');
            }
            card.draggable = true;
            card.dataset.senderId = sender.id;
            card.ondragstart = drag;
            card.onclick = (e) => {
                e.stopPropagation();
                selectSender(sender);
            };

            card.innerHTML = `
                <div class="avatar" style="background: ${sender.color}">
                    ${sender.avatar}
                    ${sender.unreadEmails > 0 ? `<div class="unread-badge">${sender.unreadEmails}</div>` : ''}
                </div>
                <div class="sender-name">${sender.name}</div>
                <div class="sender-company">${sender.company}</div>
                <div style="font-size: 12px; color: #718096; margin-bottom: 8px;">
                    ${sender.totalEmails} å°éƒµä»¶
                </div>
                <div class="tags">
                    <span class="tag ${sender.priority === 'urgent' ? 'tag-urgent' : sender.priority === 'high' ? 'tag-high' : 'tag-medium'}">
                        ${sender.priority === 'urgent' ? 'ğŸ”´' : sender.priority === 'high' ? 'ğŸŸ¡' : 'ğŸŸ¢'}
                    </span>
                    ${sender.value ? `<span class="tag tag-value">${sender.value}</span>` : ''}
                </div>
            `;

            return card;
        }

        // ===== é¸æ“‡å¯„ä»¶äºº =====
        function selectSender(sender) {
            selectedSender = sender;
            selectedEmail = null;
            renderSenders();
            showEmailsList(sender);
            showSenderAI(sender);
        }

        // ===== é¡¯ç¤ºéƒµä»¶åˆ—è¡¨ =====
        function showEmailsList(sender) {
            const section = document.getElementById('emailsListSection');
            const title = document.getElementById('emailsListTitle');
            const list = document.getElementById('emailsList');

            title.textContent = `ğŸ“§ ${sender.name} çš„éƒµä»¶åˆ—è¡¨ (${sender.totalEmails} å°)`;
            section.style.display = 'block';

            list.innerHTML = '';
            sender.emails.forEach(email => {
                const item = document.createElement('div');
                item.className = 'email-item' + (email.unread ? ' unread' : '');
                if (selectedEmail && selectedEmail.id === email.id) {
                    item.classList.add('selected');
                }

                const timeStr = formatTime(email.date);

                item.innerHTML = `
                    <div class="email-header">
                        <div class="email-subject">${email.subject}</div>
                        <div class="email-time">${timeStr}</div>
                    </div>
                    <div class="email-preview">${email.preview}</div>
                `;

                item.onclick = () => selectEmail(sender, email);
                list.appendChild(item);
            });

            // æ»¾å‹•åˆ°éƒµä»¶åˆ—è¡¨
            section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ===== é¸æ“‡éƒµä»¶ =====
        function selectEmail(sender, email) {
            selectedEmail = email;
            email.unread = false;
            sender.unreadEmails = Math.max(0, sender.unreadEmails - 1);
            showEmailsList(sender);
            showEmailContent(sender, email);
            renderSenders();
        }

        // ===== é¡¯ç¤ºéƒµä»¶å…§å®¹ =====
        function showEmailContent(sender, email) {
            const contentDiv = document.getElementById('aiDetailContent');

            contentDiv.innerHTML = `
                <div class="email-content">
                    <div class="email-content-header">
                        <div class="email-content-subject">${email.subject}</div>
                        <div class="email-content-meta">
                            ä¾†è‡ªï¼š${sender.name} (${sender.company})<br>
                            æ—¥æœŸï¼š${email.date.toLocaleString('zh-TW')}
                        </div>
                    </div>
                    <div>${email.body.replace(/\n/g, '<br>')}</div>
                    <div class="action-buttons">
                        <button class="action-btn primary" onclick="replyEmail()">â†©ï¸ å›è¦†</button>
                        <button class="action-btn" onclick="forwardEmail()">â¡ï¸ è½‰ç™¼</button>
                        <button class="action-btn" onclick="deleteEmail()">ğŸ—‘ï¸ åˆªé™¤</button>
                    </div>
                </div>

                <div class="ai-section">
                    <h3>ğŸ¤– AI è‡ªå‹•åˆ†æ</h3>
                    ${createNotesHTML(sender.notes)}
                </div>

                <div class="ai-section">
                    <h3>âœ… å¾…è¾¦äº‹é …</h3>
                    ${sender.todos.map((todo, idx) => `
                        <div class="todo-item ${todo.done ? 'done' : ''}" onclick="toggleTodo(${sender.id}, ${idx})">
                            <input type="checkbox" ${todo.done ? 'checked' : ''}>
                            <span>${todo.text}</span>
                            <small style="margin-left: auto;">${todo.date}</small>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ===== é¡¯ç¤ºå¯„ä»¶äºº AI åˆ†æ =====
        function showSenderAI(sender) {
            const contentDiv = document.getElementById('aiDetailContent');

            contentDiv.innerHTML = `
                <div class="ai-section">
                    <h3>ğŸ‘¤ ${sender.name}</h3>
                    <div style="color: #718096; font-size: 14px; margin-bottom: 12px;">
                        ${sender.company}<br>
                        å…± ${sender.totalEmails} å°éƒµä»¶ | ${sender.unreadEmails} å°æœªè®€
                    </div>
                    <div class="tags">
                        <span class="tag ${sender.priority === 'urgent' ? 'tag-urgent' : sender.priority === 'high' ? 'tag-high' : 'tag-medium'}">
                            ${sender.priority === 'urgent' ? 'ğŸ”´ ç·Šæ€¥' : sender.priority === 'high' ? 'ğŸŸ¡ é«˜å„ªå…ˆ' : 'ğŸŸ¢ ä¸€èˆ¬'}
                        </span>
                        ${sender.value ? `<span class="tag tag-value">${sender.value}</span>` : ''}
                    </div>
                </div>

                <div class="ai-section">
                    <h3>ğŸ“ AI è‡ªå‹•ç­†è¨˜</h3>
                    ${createNotesHTML(sender.notes)}
                </div>

                <div class="ai-section">
                    <h3>âš¡ å¾…è¾¦äº‹é …</h3>
                    ${sender.todos.map((todo, idx) => `
                        <div class="todo-item ${todo.done ? 'done' : ''}" onclick="toggleTodo(${sender.id}, ${idx})">
                            <input type="checkbox" ${todo.done ? 'checked' : ''}>
                            <span>${todo.text}</span>
                            <small style="margin-left: auto;">${todo.date}</small>
                        </div>
                    `).join('')}
                </div>

                <div style="text-align: center; margin-top: 20px; color: #718096; font-size: 14px;">
                    ğŸ‘ˆ é»æ“Šå·¦å´éƒµä»¶æŸ¥çœ‹å…§å®¹
                </div>
            `;
        }

        function createNotesHTML(notes) {
            return Object.entries(notes)
                .map(([key, value]) => `
                    <div class="note-item">
                        <strong>${key}:</strong> ${value}
                    </div>
                `).join('');
        }

        // ===== é—œé–‰éƒµä»¶åˆ—è¡¨ =====
        function closeEmailsList() {
            document.getElementById('emailsListSection').style.display = 'none';
            selectedSender = null;
            selectedEmail = null;
            renderSenders();
            document.getElementById('aiDetailContent').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ’¡</div>
                    <div>é»æ“Šå¯„ä»¶äººå¡ç‰‡æˆ–éƒµä»¶æŸ¥çœ‹ AI åˆ†æ</div>
                </div>
            `;
        }

        // ===== æ‹–æ‹½åŠŸèƒ½ =====
        function drag(ev) {
            ev.dataTransfer.setData("senderId", ev.target.dataset.senderId);
            ev.target.classList.add('dragging');
            ev.stopPropagation();
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function dragEnter(ev) {
            if (ev.target.classList.contains('status-zone')) {
                ev.target.classList.add('drag-over');
            }
        }

        function dragLeave(ev) {
            if (ev.target.classList.contains('status-zone')) {
                ev.target.classList.remove('drag-over');
            }
        }

        function drop(ev, newStatus) {
            ev.preventDefault();
            const senderId = parseInt(ev.dataTransfer.getData("senderId"));
            const sender = currentSenders.find(s => s.id === senderId);

            if (sender && sender.status !== newStatus) {
                sender.status = newStatus;
                renderSenders();
                updateStats();
                showNotification(`${sender.name} å·²ç§»å‹•åˆ°ã€Œ${getStatusText(newStatus)}ã€`);
            }

            document.querySelectorAll('.status-zone').forEach(zone => {
                zone.classList.remove('drag-over');
            });
            document.querySelectorAll('.sender-card').forEach(card => {
                card.classList.remove('dragging');
            });
        }

        function getStatusText(status) {
            return status === 'pending' ? 'å¾…è™•ç†' : status === 'processing' ? 'è™•ç†ä¸­' : 'å·²å®Œæˆ';
        }

        // ===== å·¥å…·å‡½æ•¸ =====
        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));

            if (days === 0) return date.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            if (days === 1) return 'æ˜¨å¤©';
            if (days < 7) return `${days} å¤©å‰`;
            return date.toLocaleDateString('zh-TW', { month: 'short', day: 'numeric' });
        }

        function updateStats() {
            updateCounts();
        }

        function updateCounts() {
            const pending = currentSenders.filter(s => s.status === 'pending').length;
            const processing = currentSenders.filter(s => s.status === 'processing').length;
            const completed = currentSenders.filter(s => s.status === 'completed').length;

            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('processingCount').textContent = processing;
            document.getElementById('completedCount').textContent = completed;
        }

        function toggleTodo(senderId, todoIdx) {
            const sender = currentSenders.find(s => s.id === senderId);
            if (sender && sender.todos) {
                sender.todos[todoIdx].done = !sender.todos[todoIdx].done;
                if (selectedEmail) {
                    showEmailContent(sender, selectedEmail);
                } else {
                    showSenderAI(sender);
                }
            }
        }

        // ===== éƒµä»¶æ“ä½œ =====
        function composeEmail() {
            document.getElementById('emailTo').value = '';
            document.getElementById('emailSubject').value = '';
            document.getElementById('emailBody').value = '';
            document.getElementById('composeModal').classList.add('active');
        }

        function closeCompose() {
            document.getElementById('composeModal').classList.remove('active');
        }

        function sendEmail() {
            alert('éƒµä»¶å·²ç™¼é€ï¼ï¼ˆDemo æ¨¡å¼ï¼‰');
            closeCompose();
        }

        function replyEmail() {
            if (selectedEmail && selectedSender) {
                document.getElementById('emailTo').value = selectedSender.name;
                document.getElementById('emailSubject').value = 'Re: ' + selectedEmail.subject;
                document.getElementById('emailBody').value = `\n\n--- åŸå§‹éƒµä»¶ ---\n${selectedEmail.body}`;
                document.getElementById('composeModal').classList.add('active');
            }
        }

        function forwardEmail() {
            if (selectedEmail) {
                document.getElementById('emailTo').value = '';
                document.getElementById('emailSubject').value = 'Fwd: ' + selectedEmail.subject;
                document.getElementById('emailBody').value = `\n\n--- è½‰ç™¼éƒµä»¶ ---\n${selectedEmail.body}`;
                document.getElementById('composeModal').classList.add('active');
            }
        }

        function deleteEmail() {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å°éƒµä»¶å—ï¼Ÿ')) {
                alert('éƒµä»¶å·²åˆªé™¤ï¼ï¼ˆDemo æ¨¡å¼ï¼‰');
            }
        }

        function syncEmails() {
            alert('åŒæ­¥å®Œæˆï¼ï¼ˆDemo æ¨¡å¼ï¼‰');
        }

        function showNotification(message) {
            alert(message);
        }

        // ===== åˆå§‹åŒ– =====
        init();

        console.log('ğŸš€ Outlook AI 2.0 èåˆç‰ˆå·²è¼‰å…¥ï¼');
        console.log('âœ¨ ç‰¹è‰²ï¼š');
        console.log('1. å¯„ä»¶äººé ­åƒè¦–è¦ºåŒ– + ä¸‰ç‹€æ…‹æ‹–æ‹½ç®¡ç†');
        console.log('2. é»æ“Šå¯„ä»¶äººå±•é–‹éƒµä»¶åˆ—è¡¨ï¼ˆ10-30å°ï¼‰');
        console.log('3. é»æ“Šéƒµä»¶æŸ¥çœ‹å®Œæ•´å…§å®¹ + AI åˆ†æ');
        console.log('4. å…± ' + sendersData.reduce((sum, s) => sum + s.totalEmails, 0) + ' å°éƒµä»¶');
    </script>
</body>
</html>
